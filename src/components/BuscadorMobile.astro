---
import { cursos } from "@lib/cursos";
import Card from "@components/extras/Card.astro";

const mostrar = [
  {
    slug: "diplomado-masoterapia",
    title: "Diplomado en masoterapia 2026",
    horas: "150",
  },
  {
    slug: "diplomado-semipresencial",
    title: "Diplomado Semipresencial 2026",
    horas: "150",
  },
  {
    slug: "masoterapia-deportiva",
    title: "Diplomado masoterapia deportiva 80 horas",
    horas: "80",
  },
];
---

<div id="segmento-buscar" class="lg:ml-4">
  <div>
    <div>
      <label class="z-3 rounded-md w-full lg:w-96 input">
        <svg
          class="opacity-50 h-[1em]"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
        >
          <g
            stroke-linejoin="round"
            stroke-linecap="round"
            stroke-width="2.5"
            fill="none"
            stroke="currentColor"
          >
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.3-4.3"></path>
          </g>
        </svg>
        <input
          type="text"
          id="buscarMobile"
          name="buscarMobile"
          autocomplete="off"
        />
      </label>
    </div>
  </div>
  <div>
    <ul id="buscadorMobile" class="gap-2 my-5 list">
      <li><h3 class="font-bold text-2xl">Cursos Recomendados</h3></li>
      {
        mostrar.map((mt) => {
          return (
            <li>
              <Card slug={mt.slug} title={mt.title} horas={mt.horas} />
            </li>
          );
        })
      }
    </ul>
  </div>
</div>

<script define:vars={{ cursos }}>
  const buscarMov = document.getElementById("buscarMobile");
  const buscadorMov = document.getElementById("buscadorMobile");

  buscarMov.addEventListener("input", () => {
    const valor = buscarMov.value.toLowerCase();
    buscadorMov.style.display = "grid";
    buscadorMov.innerHTML = "";
    if (valor === "") {
      buscadorMov.style.display = "none";
      return;
    }
    const filtradoMov = cursos.filter((curso) =>
      curso.name.toLowerCase().includes(valor),
    );
    if (filtradoMov.length > 0) buscadorMov.style.backgroundColor = "#fff";
    else buscadorMov.style.backgroundColor = "transparent";
    filtradoMov.forEach((curso) => {
      const li = document.createElement("li");
      li.innerHTML = `<a href="/cursos/${curso.slug}" class="bg-white shadow-md p-0 rounded-md h-18 lg:h-32 list-row"><div><img class="rounded-tl-md rounded-bl-md w-24 lg:w-40 h-18 lg:h-32 object-cover" src="https://cenakin.cl/images/cursos/${curso.slug}/mini.webp" alt="${curso.name}" /></div><div class="flex flex-col justify-around py-2 pr-2"><div class="font-bold lg:text-2xl line-clamp-2 leading-tight title">${curso.name}</div><div class="flex gap-1 lg:mt-2"><div class="flex items-center bg-sky-100 rounded-md text-sky-700 lg:text-xs badge"><FileBadge color="oklch(58% 0.158 241.966)" size="12" />Curso Certificado</div><div class="flex items-center bg-sky-100 rounded-md text-sky-700 lg:text-xs badge"><CalendarClock color="oklch(58% 0.158 241.966)" size="12" />${curso.acf.horas} horas</div></div></div></a>`;
      buscadorMov.appendChild(li);
      li.addEventListener("click", () => {
        buscadorMov.style.display = "none";
        buscadorMov.innerHTML = "";
      });
    });
  });
</script>

<style>
  #segmento-buscar {
    width: 100%;
    display: block;
    & svg {
      height: 1em;
    }
  }

  #buscador {
    max-height: 400px;
    overflow-y: auto;
    list-style: none;
    & li {
      cursor: pointer;
      padding: 8px;
      &:hover {
        background-color: #f5f5f5;
      }
    }
  }

  .texto-truncado {
    white-space: nowrap;
    text-overflow: ellipsis;
    overflow: hidden;

    @supports (-webkit-line-clamp: 2) {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: initial;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
    }
  }
</style>
